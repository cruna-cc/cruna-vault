const fs = require("fs");
const path = require("path");

function processDirectory(directory) {
  const files = fs.readdirSync(directory, { withFileTypes: true });

  files.forEach((file) => {
    if (file.isDirectory()) {
      processDirectory(path.join(directory, file.name)); // Recurse into directories
    } else if (file.name.endsWith(".sol")) {
      processFile(path.join(directory, file.name)); // Process Solidity files
    }
  });
}

function processFile(filePath) {
  let fileContent = fs.readFileSync(filePath, "utf8");

  // Match and transform /// comments into block comments
  const updatedContent = fileContent.replace(/(\/\/\/[^\n]*\n)+/g, (match) => {
    const block = match
      .trim() // Remove leading/trailing whitespace
      .split("\n") // Split into lines
      .map((line) => line.replace("///", " *")) // Replace '///' with ' *'
      .join("\n"); // Rejoin into a single string
    return `/**\n${block}\n */\n`; // Wrap with block comment syntax
  });

  if (fileContent !== updatedContent) {
    fs.writeFileSync(filePath, updatedContent, "utf8");
    console.log(`Updated: ${filePath}`);
  }
}

// Adjust the base directory path as per your project structure
const baseDir = path.resolve(__dirname, "../contracts");
processDirectory(baseDir);
